# Automating SBOM Generation in CI/CD

## Pipeline create for scan
Now we will create a pipeline for create SBOM report. For this we will use `syft` and `grype`
```yaml

name: Generate SBOM Report with Syft

on:
  workflow_dispatch: 
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  generate-sbom:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Install Syft
      run: |
        curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin

    - name: Generate SBOM
      run: |
        syft azizctg08/app:v1.1 -o spdx-json > spdx.json

    - name: Install Grype 
      run: |
        curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin

    - name: Generate CVE report
      run: |
        grype sbom:./spdx.json -o json > app-spdx-report.json

    - name: Upload SBOM Artifact
      uses: actions/upload-artifact@v4
      with:
        name: spdx-report
        path: spdx.json


    - name: Upload Vulnerabilities Artifact
      uses: actions/upload-artifact@v4
      with:
        name: vuln-report
        path: app-spdx-report.json       

```

## Some steps need to inform

Make sure your workflow file is in the correct path:  
```
.github/workflows/ci.yml
```

Also, verify the trigger conditions:  
```yaml
on: 
  push:
    branches:
      - main
```
- Make sure you are pushing to the correct branch.  

---

**After push the code into github repo. This pipeline will be start executing. Follow below steps for**

## Steps to Download the Artifact from the Workflow via GitHub UI
1. Navigate to Your Repository
Go to the GitHub repository where the workflow is running.
2. Go to the Actions Tab
In the repository, click on the Actions tab at the top.
This will display a list of all recent workflow runs for this repository.
3. Select the Workflow Run
Locate the specific workflow run you want (e.g., "Generate SBOM Report with Syft").
Click on the workflow name or the commit message associated with the workflow to open the run details.
4. View Workflow Job Details
On the workflow run page, youâ€™ll see the jobs that ran (e.g., generate-sbom).
Click on the job name to see more details of the jobâ€™s steps and logs.
5. Locate the Artifact Section
Scroll down to the bottom of the workflow run page.
Under the Artifacts section, youâ€™ll find the list of artifacts generated by this workflow (e.g., sbom-report, vuln-report).
6. Download the Artifact
Click on the artifact name (e.g., sbom-report, vuln-report).
The artifact will be downloaded as a .zip file, which you can then unzip to access its contents.
7. Examine the SBOM artifact.
By following these steps, you can access and download artifacts from your workflow run directly through the GitHub UI.


---

## **Basic GitHub Action Workflow Example**  
Letâ€™s start with a simple example where we build and test a Go application.  

### ðŸ“‚ **Directory Structure:**  
```
myapp/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci.yml
â”œâ”€â”€ main.go
â””â”€â”€ go.mod
```

### ðŸ“„ **ci.yml** (Workflow file):  
```yaml
name: CI Pipeline

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.20'
          
      - name: Build the application
        run: go build -o myapp main.go

      - name: Run tests
        run: go test ./...
```

### âœ… **How to Trigger:**  
- This pipeline runs on every **push** and **pull request**.  
- It will:  
  1. Checkout the code.  
  2. Set up the Go environment.  
  3. Build the application.  
  4. Run tests.  

---




